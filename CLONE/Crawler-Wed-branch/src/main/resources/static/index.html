<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ç½‘é¡µå†…å®¹æå–å™¨</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 2rem;
    }

    .container {
      max-width: 900px;
      margin: 0 auto;
      background-color: #ffffff;
      border-radius: 20px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.1);
      overflow: hidden;
    }

    .header {
      background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
      color: white;
      padding: 2rem;
      text-align: center;
    }

    .header h1 {
      font-size: 2.5rem;
      margin-bottom: 0.5rem;
      font-weight: 600;
    }

    .header p {
      font-size: 1.1rem;
      opacity: 0.9;
    }

    .main-content {
      padding: 2rem;
    }

    .input-section {
      margin-bottom: 2rem;
    }

    .input-group {
      display: flex;
      gap: 1rem;
      margin-bottom: 1rem;
    }

    .url-input {
      flex: 1;
      padding: 1rem;
      border: 2px solid #e1e8ed;
      border-radius: 10px;
      font-size: 1rem;
      transition: all 0.3s ease;
    }

    .url-input:focus {
      outline: none;
      border-color: #4facfe;
      box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.1);
    }

    .extract-btn {
      padding: 1rem 2rem;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 10px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      min-width: 120px;
    }

    .extract-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
    }

    .extract-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    .supported-sites {
      background-color: #f8f9fa;
      padding: 1rem;
      border-radius: 10px;
      margin-bottom: 1rem;
    }

    .supported-sites h3 {
      color: #495057;
      margin-bottom: 0.5rem;
      font-size: 1rem;
    }

    .site-tags {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
    }

    .site-tag {
      background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
      color: #333;
      padding: 0.3rem 0.8rem;
      border-radius: 20px;
      font-size: 0.85rem;
      font-weight: 500;
    }

    .loading {
      display: none;
      text-align: center;
      margin: 2rem 0;
    }

    .spinner {
      border: 3px solid #f3f3f3;
      border-top: 3px solid #4facfe;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 0 auto 1rem;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .result-section {
      display: none;
      background-color: #f8f9fa;
      border-radius: 15px;
      padding: 1.5rem;
      margin-top: 2rem;
    }

    .result-item {
      margin-bottom: 1.5rem;
      background-color: white;
      padding: 1rem;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    }

    .result-item:last-child {
      margin-bottom: 0;
    }

    .result-label {
      font-weight: 600;
      color: #495057;
      margin-bottom: 0.5rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .result-label::before {
      content: '';
      width: 4px;
      height: 20px;
      background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
      border-radius: 2px;
    }

    .result-content {
      color: #333;
      line-height: 1.6;
      white-space: pre-wrap;
      word-wrap: break-word;
    }

    .error-message {
      background-color: #fff5f5;
      border: 1px solid #fed7d7;
      color: #c53030;
      padding: 1rem;
      border-radius: 10px;
      margin-top: 1rem;
      display: none;
    }

    .success-message {
      background-color: #f0fff4;
      border: 1px solid #9ae6b4;
      color: #2f855a;
      padding: 1rem;
      border-radius: 10px;
      margin-top: 1rem;
      display: none;
    }

    @media (max-width: 768px) {
      body {
        padding: 1rem;
      }
      
      .input-group {
        flex-direction: column;
      }
      
      .header h1 {
        font-size: 2rem;
      }
      
      .main-content {
        padding: 1rem;
      }
    }
  </style>
</head>
<body>

<div class="container">
  <div class="header">
    <h1>ğŸ” ç½‘é¡µå†…å®¹æå–å™¨</h1>
    <p>å¿«é€Ÿæå–ç½‘é¡µçš„æ ‡é¢˜ã€æ­£æ–‡å†…å®¹å’Œå…³é”®è¯</p>
  </div>

  <div class="main-content">
    <div class="input-section">
      <div class="input-group">
        <input type="url" id="url-input" class="url-input" placeholder="è¯·è¾“å…¥è¦æå–å†…å®¹çš„ç½‘é¡µURL..." autocomplete="off">
        <button id="extract-btn" class="extract-btn">æå–å†…å®¹</button>
      </div>

      <div class="supported-sites">
        <h3>ğŸŒ æ”¯æŒçš„ç½‘ç«™</h3>
        <div class="site-tags">
          <span class="site-tag">å°çº¢ä¹¦ (xiaohongshu.com)</span>
          <span class="site-tag">ä»Šæ—¥å¤´æ¡ (toutiao.com)</span>
          <span class="site-tag">ç™¾å®¶å· (mbd.baidu.com)</span>
          <span class="site-tag">å¾®ä¿¡å…¬ä¼—å· (mp.weixin.qq.com)</span>
        </div>
      </div>
    </div>

    <div class="loading" id="loading">
      <div class="spinner"></div>
      <p>æ­£åœ¨æå–å†…å®¹ï¼Œè¯·ç¨å€™...</p>
    </div>

    <div class="error-message" id="error-message"></div>
    <div class="success-message" id="success-message"></div>

        <div class="result-section" id="result-section">
      <div class="result-item">
        <div class="result-label">ğŸ“ æ ‡é¢˜</div>
        <div class="result-content" id="title-content"></div>
      </div>
      
      <div class="result-item">
        <div class="result-label">ğŸ“„ æ­£æ–‡å†…å®¹</div>
        <div class="result-content" id="maintext-content"></div>
      </div>
      
      <div class="result-item">
        <div class="result-label">ğŸ·ï¸ å…³é”®è¯</div>
        <div class="result-content" id="keywords-content"></div>
      </div>
      
      <!-- ä»Šæ—¥å¤´æ¡ä¸“ç”¨å­—æ®µ -->
      <div class="result-item" id="publish-time-item" style="display: none;">
        <div class="result-label">â° å‘å¸ƒæ—¶é—´</div>
        <div class="result-content" id="publish-time-content"></div>
      </div>
      
      <div class="result-item" id="comment-count-item" style="display: none;">
        <div class="result-label">ğŸ’¬ è¯„è®ºæ•°</div>
        <div class="result-content" id="comment-count-content"></div>
      </div>
      
      <div class="result-item" id="like-count-item" style="display: none;">
        <div class="result-label">ğŸ‘ ç‚¹èµæ•°</div>
        <div class="result-content" id="like-count-content"></div>
      </div>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', () => {
      const urlInput = document.getElementById('url-input');
      const extractBtn = document.getElementById('extract-btn');
      const loading = document.getElementById('loading');
      const resultSection = document.getElementById('result-section');
      const errorMessage = document.getElementById('error-message');
      const successMessage = document.getElementById('success-message');
      
      const titleContent = document.getElementById('title-content');
      const maintextContent = document.getElementById('maintext-content');
      const keywordsContent = document.getElementById('keywords-content');
      
      // æ–°å¢å­—æ®µå…ƒç´ 
      const publishTimeItem = document.getElementById('publish-time-item');
      const publishTimeContent = document.getElementById('publish-time-content');
      const commentCountItem = document.getElementById('comment-count-item');
      const commentCountContent = document.getElementById('comment-count-content');
      const likeCountItem = document.getElementById('like-count-item');
      const likeCountContent = document.getElementById('like-count-content');

      // éšè—æ‰€æœ‰æ¶ˆæ¯
      function hideMessages() {
          errorMessage.style.display = 'none';
          successMessage.style.display = 'none';
          resultSection.style.display = 'none';
      }

      // æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯
      function showError(message) {
          hideMessages();
          errorMessage.textContent = message;
          errorMessage.style.display = 'block';
      }

      // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
      function showSuccess(message) {
          hideMessages();
          successMessage.textContent = message;
          successMessage.style.display = 'block';
      }

      // æ£€æŸ¥URLç±»å‹çš„å‡½æ•°
      function getUrlType(url) {
          try {
              const urlObj = new URL(url);
              const hostname = urlObj.hostname;
              
              if (hostname === 'www.toutiao.com') return 'toutiao';
              if (hostname === 'www.xiaohongshu.com') return 'xiaohongshu';
              if (hostname === 'mbd.baidu.com') return 'baijiahao';
              if (hostname === 'mp.weixin.qq.com') return 'wechat';
              
              return 'unknown';
          } catch (_) {
              return 'unknown';
          }
      }

      // æ˜¾ç¤ºç»“æœ
      function showResult(data) {
          // åªéšè—é”™è¯¯å’ŒæˆåŠŸæ¶ˆæ¯ï¼Œä¸éšè—ç»“æœåŒºåŸŸ
          errorMessage.style.display = 'none';
          successMessage.style.display = 'none';
          
          titleContent.textContent = data.title || 'æ— æ ‡é¢˜';
          maintextContent.textContent = data.maintext || 'æ— æ­£æ–‡å†…å®¹';
          keywordsContent.textContent = data.keywords || 'æ— å…³é”®è¯';
          
          // æ£€æŸ¥URLç±»å‹å¹¶æ˜¾ç¤ºç›¸åº”çš„é¢å¤–å­—æ®µ
          const currentUrl = urlInput.value.trim();
          const urlType = getUrlType(currentUrl);
          
          // å‘å¸ƒæ—¶é—´ - æ‰€æœ‰å¹³å°éƒ½æ”¯æŒ
          if (data.publishTime && data.publishTime !== 'æœªçŸ¥æ—¶é—´' && data.publishTime !== '') {
              publishTimeContent.textContent = data.publishTime;
              publishTimeItem.style.display = 'block';
          } else {
              publishTimeItem.style.display = 'none';
          }
          
          // è¯„è®ºæ•°å’Œç‚¹èµæ•° - ä»Šæ—¥å¤´æ¡å’Œç™¾å®¶å·æ”¯æŒ
          if (urlType === 'toutiao' || urlType === 'baijiahao') {
              if (data.commentCount && data.commentCount !== '0' && data.commentCount !== '') {
                  commentCountContent.textContent = data.commentCount;
                  commentCountItem.style.display = 'block';
              } else {
                  commentCountItem.style.display = 'none';
              }
              
              if (data.likeCount && data.likeCount !== '0' && data.likeCount !== '') {
                  likeCountContent.textContent = data.likeCount;
                  likeCountItem.style.display = 'block';
              } else {
                  likeCountItem.style.display = 'none';
              }
          } else {
              // å…¶ä»–å¹³å°éšè—è¯„è®ºæ•°å’Œç‚¹èµæ•°
              commentCountItem.style.display = 'none';
              likeCountItem.style.display = 'none';
          }
          
          resultSection.style.display = 'block';
          
          // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯ä½†ä¸éšè—ç»“æœåŒºåŸŸ
          successMessage.textContent = 'å†…å®¹æå–æˆåŠŸï¼';
          successMessage.style.display = 'block';
      }

      // éªŒè¯URLæ ¼å¼
      function isValidUrl(string) {
          try {
              const url = new URL(string);
              return url.protocol === 'http:' || url.protocol === 'https:';
          } catch (_) {
              return false;
          }
      }

      // æ£€æŸ¥æ˜¯å¦ä¸ºæ”¯æŒçš„ç½‘ç«™
      function isSupportedSite(url) {
          const urlType = getUrlType(url);
          return urlType !== 'unknown';
      }



      // æå–å†…å®¹
      async function extractContent() {
          const url = urlInput.value.trim();
          
          if (!url) {
              showError('è¯·è¾“å…¥ç½‘é¡µURL');
              return;
          }

          if (!isValidUrl(url)) {
              showError('è¯·è¾“å…¥æœ‰æ•ˆçš„URLæ ¼å¼ï¼ˆéœ€è¦åŒ…å« http:// æˆ– https://ï¼‰');
              return;
          }

          if (!isSupportedSite(url)) {
              showError('æš‚ä¸æ”¯æŒè¯¥ç½‘ç«™ï¼Œç›®å‰æ”¯æŒï¼šå°çº¢ä¹¦ã€ä»Šæ—¥å¤´æ¡ã€ç™¾å®¶å·ã€å¾®ä¿¡å…¬ä¼—å·');
              return;
          }

          // å¼€å§‹åŠ è½½
          hideMessages();
          loading.style.display = 'block';
          extractBtn.disabled = true;
          extractBtn.textContent = 'æå–ä¸­...';

          try {
              const apiBaseUrl = window.location.origin;
              const response = await fetch(`/extract?url=${encodeURIComponent(url)}`);
              
              if (!response.ok) {
                  throw new Error(`HTTPé”™è¯¯: ${response.status}`);
              }
              
              const data = await response.json();
              
              if (data) {
                  showResult(data);
              } else {
                  showError('æå–å¤±è´¥ï¼Œè¯·æ£€æŸ¥URLæ˜¯å¦æ­£ç¡®');
              }
              
          } catch (error) {
              console.error('æå–å†…å®¹æ—¶å‘ç”Ÿé”™è¯¯:', error);
              if (error.name === 'TypeError' && error.message.includes('fetch')) {
                  showError('æ— æ³•è¿æ¥åˆ°æœåŠ¡å™¨ï¼Œè¯·ç¡®ä¿åç«¯æœåŠ¡æ­£åœ¨è¿è¡Œ');
              } else {
                  showError(`æå–å¤±è´¥: ${error.message}`);
              }
          } finally {
              // ç»“æŸåŠ è½½
              loading.style.display = 'none';
              extractBtn.disabled = false;
              extractBtn.textContent = 'æå–å†…å®¹';
          }
      }

      // ç»‘å®šäº‹ä»¶
      extractBtn.addEventListener('click', extractContent);

      urlInput.addEventListener('keypress', (e) => {
          if (e.key === 'Enter') {
              extractContent();
          }
      });

      // URLè¾“å…¥æ¡†å˜åŒ–æ—¶éšè—ä¹‹å‰çš„æ¶ˆæ¯
      urlInput.addEventListener('input', hideMessages);
  });
</script>

</body>
</html>