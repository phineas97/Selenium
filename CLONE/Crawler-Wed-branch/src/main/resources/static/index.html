<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>网页内容提取器</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 2rem;
    }

    .container {
      max-width: 900px;
      margin: 0 auto;
      background-color: #ffffff;
      border-radius: 20px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.1);
      overflow: hidden;
    }

    .header {
      background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
      color: white;
      padding: 2rem;
      text-align: center;
    }

    .header h1 {
      font-size: 2.5rem;
      margin-bottom: 0.5rem;
      font-weight: 600;
    }

    .header p {
      font-size: 1.1rem;
      opacity: 0.9;
    }

    .main-content {
      padding: 2rem;
    }

    .input-section {
      margin-bottom: 2rem;
    }

    .input-group {
      display: flex;
      gap: 1rem;
      margin-bottom: 1rem;
    }

    .url-input {
      flex: 1;
      padding: 1rem;
      border: 2px solid #e1e8ed;
      border-radius: 10px;
      font-size: 1rem;
      transition: all 0.3s ease;
    }

    .url-input:focus {
      outline: none;
      border-color: #4facfe;
      box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.1);
    }

    .extract-btn {
      padding: 1rem 2rem;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 10px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      min-width: 120px;
    }

    .extract-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
    }

    .extract-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    .supported-sites {
      background-color: #f8f9fa;
      padding: 1rem;
      border-radius: 10px;
      margin-bottom: 1rem;
    }

    .supported-sites h3 {
      color: #495057;
      margin-bottom: 0.5rem;
      font-size: 1rem;
    }

    .site-tags {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
    }

    .site-tag {
      background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
      color: #333;
      padding: 0.3rem 0.8rem;
      border-radius: 20px;
      font-size: 0.85rem;
      font-weight: 500;
    }

    .loading {
      display: none;
      text-align: center;
      margin: 2rem 0;
    }

    .spinner {
      border: 3px solid #f3f3f3;
      border-top: 3px solid #4facfe;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 0 auto 1rem;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .result-section {
      display: none;
      background-color: #f8f9fa;
      border-radius: 15px;
      padding: 1.5rem;
      margin-top: 2rem;
    }

    .result-item {
      margin-bottom: 1.5rem;
      background-color: white;
      padding: 1rem;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    }

    .result-item:last-child {
      margin-bottom: 0;
    }

    .result-label {
      font-weight: 600;
      color: #495057;
      margin-bottom: 0.5rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .result-label::before {
      content: '';
      width: 4px;
      height: 20px;
      background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
      border-radius: 2px;
    }

    .result-content {
      color: #333;
      line-height: 1.6;
      white-space: pre-wrap;
      word-wrap: break-word;
    }

    .error-message {
      background-color: #fff5f5;
      border: 1px solid #fed7d7;
      color: #c53030;
      padding: 1rem;
      border-radius: 10px;
      margin-top: 1rem;
      display: none;
    }

    .success-message {
      background-color: #f0fff4;
      border: 1px solid #9ae6b4;
      color: #2f855a;
      padding: 1rem;
      border-radius: 10px;
      margin-top: 1rem;
      display: none;
    }

    @media (max-width: 768px) {
      body {
        padding: 1rem;
      }
      
      .input-group {
        flex-direction: column;
      }
      
      .header h1 {
        font-size: 2rem;
      }
      
      .main-content {
        padding: 1rem;
      }
    }
  </style>
</head>
<body>

<div class="container">
  <div class="header">
    <h1>🔍 网页内容提取器</h1>
    <p>快速提取网页的标题、正文内容和关键词</p>
  </div>

  <div class="main-content">
    <div class="input-section">
      <div class="input-group">
        <input type="url" id="url-input" class="url-input" placeholder="请输入要提取内容的网页URL..." autocomplete="off">
        <button id="extract-btn" class="extract-btn">提取内容</button>
      </div>

      <div class="supported-sites">
        <h3>🌐 支持的网站</h3>
        <div class="site-tags">
          <span class="site-tag">小红书 (xiaohongshu.com)</span>
          <span class="site-tag">今日头条 (toutiao.com)</span>
          <span class="site-tag">百家号 (mbd.baidu.com)</span>
          <span class="site-tag">微信公众号 (mp.weixin.qq.com)</span>
        </div>
      </div>
    </div>

    <div class="loading" id="loading">
      <div class="spinner"></div>
      <p>正在提取内容，请稍候...</p>
    </div>

    <div class="error-message" id="error-message"></div>
    <div class="success-message" id="success-message"></div>

        <div class="result-section" id="result-section">
      <div class="result-item">
        <div class="result-label">📝 标题</div>
        <div class="result-content" id="title-content"></div>
      </div>
      
      <div class="result-item">
        <div class="result-label">📄 正文内容</div>
        <div class="result-content" id="maintext-content"></div>
      </div>
      
      <div class="result-item">
        <div class="result-label">🏷️ 关键词</div>
        <div class="result-content" id="keywords-content"></div>
      </div>
      
      <!-- 今日头条专用字段 -->
      <div class="result-item" id="publish-time-item" style="display: none;">
        <div class="result-label">⏰ 发布时间</div>
        <div class="result-content" id="publish-time-content"></div>
      </div>
      
      <div class="result-item" id="comment-count-item" style="display: none;">
        <div class="result-label">💬 评论数</div>
        <div class="result-content" id="comment-count-content"></div>
      </div>
      
      <div class="result-item" id="like-count-item" style="display: none;">
        <div class="result-label">👍 点赞数</div>
        <div class="result-content" id="like-count-content"></div>
      </div>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', () => {
      const urlInput = document.getElementById('url-input');
      const extractBtn = document.getElementById('extract-btn');
      const loading = document.getElementById('loading');
      const resultSection = document.getElementById('result-section');
      const errorMessage = document.getElementById('error-message');
      const successMessage = document.getElementById('success-message');
      
      const titleContent = document.getElementById('title-content');
      const maintextContent = document.getElementById('maintext-content');
      const keywordsContent = document.getElementById('keywords-content');
      
      // 新增字段元素
      const publishTimeItem = document.getElementById('publish-time-item');
      const publishTimeContent = document.getElementById('publish-time-content');
      const commentCountItem = document.getElementById('comment-count-item');
      const commentCountContent = document.getElementById('comment-count-content');
      const likeCountItem = document.getElementById('like-count-item');
      const likeCountContent = document.getElementById('like-count-content');

      // 隐藏所有消息
      function hideMessages() {
          errorMessage.style.display = 'none';
          successMessage.style.display = 'none';
          resultSection.style.display = 'none';
      }

      // 显示错误消息
      function showError(message) {
          hideMessages();
          errorMessage.textContent = message;
          errorMessage.style.display = 'block';
      }

      // 显示成功消息
      function showSuccess(message) {
          hideMessages();
          successMessage.textContent = message;
          successMessage.style.display = 'block';
      }

      // 检查URL类型的函数
      function getUrlType(url) {
          try {
              const urlObj = new URL(url);
              const hostname = urlObj.hostname;
              
              if (hostname === 'www.toutiao.com') return 'toutiao';
              if (hostname === 'www.xiaohongshu.com') return 'xiaohongshu';
              if (hostname === 'mbd.baidu.com') return 'baijiahao';
              if (hostname === 'mp.weixin.qq.com') return 'wechat';
              
              return 'unknown';
          } catch (_) {
              return 'unknown';
          }
      }

      // 显示结果
      function showResult(data) {
          // 只隐藏错误和成功消息，不隐藏结果区域
          errorMessage.style.display = 'none';
          successMessage.style.display = 'none';
          
          titleContent.textContent = data.title || '无标题';
          maintextContent.textContent = data.maintext || '无正文内容';
          keywordsContent.textContent = data.keywords || '无关键词';
          
          // 检查URL类型并显示相应的额外字段
          const currentUrl = urlInput.value.trim();
          const urlType = getUrlType(currentUrl);
          
          // 发布时间 - 所有平台都支持
          if (data.publishTime && data.publishTime !== '未知时间' && data.publishTime !== '') {
              publishTimeContent.textContent = data.publishTime;
              publishTimeItem.style.display = 'block';
          } else {
              publishTimeItem.style.display = 'none';
          }
          
          // 评论数和点赞数 - 今日头条和百家号支持
          if (urlType === 'toutiao' || urlType === 'baijiahao') {
              if (data.commentCount && data.commentCount !== '0' && data.commentCount !== '') {
                  commentCountContent.textContent = data.commentCount;
                  commentCountItem.style.display = 'block';
              } else {
                  commentCountItem.style.display = 'none';
              }
              
              if (data.likeCount && data.likeCount !== '0' && data.likeCount !== '') {
                  likeCountContent.textContent = data.likeCount;
                  likeCountItem.style.display = 'block';
              } else {
                  likeCountItem.style.display = 'none';
              }
          } else {
              // 其他平台隐藏评论数和点赞数
              commentCountItem.style.display = 'none';
              likeCountItem.style.display = 'none';
          }
          
          resultSection.style.display = 'block';
          
          // 显示成功消息但不隐藏结果区域
          successMessage.textContent = '内容提取成功！';
          successMessage.style.display = 'block';
      }

      // 验证URL格式
      function isValidUrl(string) {
          try {
              const url = new URL(string);
              return url.protocol === 'http:' || url.protocol === 'https:';
          } catch (_) {
              return false;
          }
      }

      // 检查是否为支持的网站
      function isSupportedSite(url) {
          const urlType = getUrlType(url);
          return urlType !== 'unknown';
      }



      // 提取内容
      async function extractContent() {
          const url = urlInput.value.trim();
          
          if (!url) {
              showError('请输入网页URL');
              return;
          }

          if (!isValidUrl(url)) {
              showError('请输入有效的URL格式（需要包含 http:// 或 https://）');
              return;
          }

          if (!isSupportedSite(url)) {
              showError('暂不支持该网站，目前支持：小红书、今日头条、百家号、微信公众号');
              return;
          }

          // 开始加载
          hideMessages();
          loading.style.display = 'block';
          extractBtn.disabled = true;
          extractBtn.textContent = '提取中...';

          try {
              const apiBaseUrl = window.location.origin;
              const response = await fetch(`/extract?url=${encodeURIComponent(url)}`);
              
              if (!response.ok) {
                  throw new Error(`HTTP错误: ${response.status}`);
              }
              
              const data = await response.json();
              
              if (data) {
                  showResult(data);
              } else {
                  showError('提取失败，请检查URL是否正确');
              }
              
          } catch (error) {
              console.error('提取内容时发生错误:', error);
              if (error.name === 'TypeError' && error.message.includes('fetch')) {
                  showError('无法连接到服务器，请确保后端服务正在运行');
              } else {
                  showError(`提取失败: ${error.message}`);
              }
          } finally {
              // 结束加载
              loading.style.display = 'none';
              extractBtn.disabled = false;
              extractBtn.textContent = '提取内容';
          }
      }

      // 绑定事件
      extractBtn.addEventListener('click', extractContent);

      urlInput.addEventListener('keypress', (e) => {
          if (e.key === 'Enter') {
              extractContent();
          }
      });

      // URL输入框变化时隐藏之前的消息
      urlInput.addEventListener('input', hideMessages);
  });
</script>

</body>
</html>